# ======================================================================================================================
# By: Benjamin Wilcox (bwilcox@ltu.edu),
# AdUpdater_2- 6/2/2021
# ======================================================================================================================
# Description:
# Handles connection with ad clients
# ======================================================================================================================

# ======================================================================================================================
# =============================== imports ==============================================================================
# ======================================================================================================================
import os
import socket
from SharedAssets.Config import Config as Config
# ======================================================================================================================
# =============================== create vars ==========================================================================
# ======================================================================================================================
cwd = os.getcwd()
dir_path = os.path.dirname(os.path.realpath(__file__))
cfg = Config(configFile="servercfg.json", fileDir=os.path.join(dir_path, "config"))
cfg.load()
# ======================================================================================================================
# =============================== load cfg vars ========================================================================
# ======================================================================================================================
host = cfg.getVal("host")
port = cfg.getVal("port") # Port to listen on (non-privileged ports are > 1023)

# ======================================================================================================================
# =============================== main logic ===========================================================================
# ======================================================================================================================
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.bind((host, port))
    s.listen()
    conn, addr = s.accept()
    with conn:
        print('Connected by', addr)
        while True:
            data = conn.recv(1024)
            if not data:
                break
            conn.sendall(data)
